# 申万行业指数估值百分位分析工具

基于 Tushare `sw_daily` 接口，获取申万行业指数的市盈率(PE)和市净率(PB)，计算历史百分位并排序输出。

## 功能特性

- 支持一级/二级/三级行业分类
- 直接获取官方PE/PB数据（无需手动计算）
- 计算历史百分位，评估估值水平
- 支持自定义采样间隔
- 支持自定义输出目录
- 自动处理API频率限制

## 环境要求

- Python 3.7+
- Tushare 账号（需5000积分权限，可使用 `sw_daily` 接口）

## 安装依赖

```bash
pip install tushare pandas
```

## 配置

在脚本中修改你的 Tushare Token：

```python
# 在 industry_pe_pb_sw.py 中找到以下行，替换为你的Token
TOKEN = '你的Tushare Token'
```

获取 Token：注册 [Tushare](https://tushare.pro/) 账号后，在个人中心获取。

## 使用方法

### 基本用法

```bash
# 默认：一级行业，1年历史，输出到当前目录
python industry_pe_pb_sw.py

# 二级行业
python industry_pe_pb_sw.py --level L2

# 三级行业
python industry_pe_pb_sw.py --level L3

# 指定历史年数
python industry_pe_pb_sw.py --years 3

# 指定输出目录
python industry_pe_pb_sw.py --output ./results

# 组合使用
python industry_pe_pb_sw.py --level L2 --years 3 --output ./results
```

### 命令行参数

| 参数 | 短参数 | 默认值 | 说明 |
|------|--------|--------|------|
| `--level` | `-L` | L1 | 行业分类级别：L1-一级行业，L2-二级行业，L3-三级行业 |
| `--years` | `-y` | 1 | 回看历史年数 |
| `--interval` | `-i` | 0 | 采样间隔天数（0表示使用全部交易日数据） |
| `--output` | `-o` | . | 输出目录路径 |

## 输出示例

### 控制台输出

```
======================================================================
申万行业指数市盈率市净率历史百分位分析 - sw_daily版
======================================================================

📊 使用接口: sw_daily (直接获取官方PE/PB数据)
📅 分析时间范围: 最近 1 年
📊 行业级别: 一级行业

【步骤1】获取申万一级行业列表...
✅ 获取到 31 个一级行业

【步骤2】获取各行业PE/PB历史数据...
  处理: 银行(申万) (801780.SI)
    ✅ PE=5.94 (4.12%), PB=0.50 (0.82%)
  ...

======================================================================
申万一级行业估值百分位排名（按PE百分位从低到高）
======================================================================
排名   行业代码         行业名称                 PE         PE百分位      PB         PB百分位
------------------------------------------------------------------------------------------
1    801780.SI    银行(申万)               5.94       4.1%       0.50       0.8%
2    801790.SI    非银金融(申万)             12.78      5.3%       1.32       38.9%
3    801120.SI    食品饮料(申万)             21.03      36.0%      3.82       5.3%
...

✅ 结果已保存至: ./output/industry_pe_pb_sw_L1_20260226_190534.csv
```

### CSV 文件字段说明

| 字段 | 说明 |
|------|------|
| index_code | 行业指数代码 |
| index_name | 行业名称 |
| pe | 当前市盈率 |
| pe_percentile | PE历史百分位（%） |
| pb | 当前市净率 |
| pb_percentile | PB历史百分位（%） |
| sample_count | 采样数据点数 |
| latest_date | 最新数据日期 |

## 百分位计算方法

采用标准百分位计算公式：

```
百分位 = (小于当前值的数量 + 0.5 × 等于当前值的数量) / 总数量 × 100%
```

百分位越低，表示当前估值相对于历史越便宜。

## 常见问题

### 1. 提示"抱歉，您没有访问该接口的权限"

`sw_daily` 接口需要5000积分权限。请确认你的Tushare账号积分是否足够。

### 2. 触发频率限制

脚本已内置频率限制处理机制，会自动等待后重试。如频繁触发，可适当增加 `REQUEST_INTERVAL` 参数值。

### 3. 部分行业无数据

某些退市行业指数可能无历史数据，脚本会自动跳过并标记为"⚠️ 无数据"。

## 数据来源

- [Tushare](https://tushare.pro/) - 金融数据接口
- [申万宏源](http://www.swsindex.com/) - 行业分类标准

## License

MIT
